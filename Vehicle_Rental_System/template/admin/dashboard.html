{% extends "admin/bases.html" %}

{% block content %}
    <h2>Dashboard Overview</h2>
    <div class="row">
        <div class="col-md-3">
            <div class="card text-white bg-primary">
                <div class="card-body">
                    <h5 class="card-title">Total Revenue</h5>
                    <p class="card-text h2" id="total-revenue">${{ total_revenue }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-warning">
                <div class="card-body">
                    <h5 class="card-title">Pending Payments</h5>
                    <p class="card-text h2" id="pending-payments">{{ pending_payments_count }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-success">
                <div class="card-body">
                    <h5 class="card-title">Active Rentals</h5>
                    <p class="card-text h2" id="active-rentals">{{ active_rentals_count }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-info">
                <div class="card-body">
                    <h5 class="card-title">In Maintenance</h5>
                    <p class="card-text h2" id="in-maintenance">{{ maintenance_vehicles_count }}</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        <div class="col-md-12">
            <h3>Recent Activity</h3>
            </div>
    </div>
{% endblock %}

{% block extra_js %}
<script>
    function updateDashboard() {
        fetch("{% url 'get_dashboard_data' %}")
            .then(response => response.json())
            .then(data => {
                document.getElementById('total-revenue').innerText = `$${data.total_revenue.toFixed(2)}`;
                document.getElementById('pending-payments').innerText = data.pending_payments_count;
                document.getElementById('active-rentals').innerText = data.active_rentals_count;
                document.getElementById('in-maintenance').innerText = data.maintenance_vehicles_count;
            });
    }

    // Call the function once when the page loads
    updateDashboard();

    // Then, update the dashboard every 5 seconds
    setInterval(updateDashboard, 5000);
</script>
{% endblock %}